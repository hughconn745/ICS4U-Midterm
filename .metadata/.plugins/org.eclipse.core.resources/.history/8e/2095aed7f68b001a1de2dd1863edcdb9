#include "Main.h"

int searchForPhrase(char * input, char * keyphrase, int pos, int input_length) {

	char * toCmp = new char[strlen(keyphrase)];

	for(int i = pos, j = 0; i < strlen(keyphrase) + pos; i++, j++)
		toCmp[j] = input[i];

	while(strncmp(toCmp, keyphrase, strlen(keyphrase)) && pos <= input_length) {

		pos++;
		cout << "\tsubcheck 5 : " << pos << endl;
		for(int i = 0; i < strlen(keyphrase); i++) {
			cout << "\t\tsubcheck 5.5" << endl;
			toCmp[i] = input[i + pos];
		}
		}
	cout << "\tsubcheck 6" << endl;
		cout << "Instance of keyphrase found:" << endl;

		if(pos > 10){
			cout << "\tsubcheck 8" << endl;
			for(int j = pos - 10; j < pos + 10; j++) {
				cout << input[j];
			}
		}else{
			for(int k = pos; k < pos + 10; k++) {
				cout << input[k];
			}
		}
		cout << "\tsubcheck 9" << endl;
	return pos;
}

void replaceWord(char ** input, char * keyphrase, char * newChar) {
	cout << "check 1" << endl;
	int arraySize = ARRAY_LENGTH * (para_size - 1);
	char* output = new char[arraySize];
	cout << "check 2" << endl;
	output[0] = '\0';
	for(int i = 0; i < para_size - 1; i++) {
	    strncat(output, array[i], ARRAY_LENGTH - 1);
	}

	int pos = 0;
	cout << "check 3" << endl;
	while(pos < arraySize - strlen(keyphrase)) {
		cout << "check 4" << endl;
		pos = searchForPhrase(output, newChar, pos, arraySize);

		cout << "Would you like to replace this instance? yes/no" << endl;
		cout << "check 5" << endl;
		char * choice = new char[5];
		cout << "check 6" << endl;
		if(fgets(choice, 2, stdin) == NULL) {
			cout << "Error: Failed to receive input" << endl;
		}

		if(strncmp(choice, "no", 2) == 0)
			continue;
		cout << "check 7" << endl;
		char * buffer;
		cout << "check 8" << endl;
		if(strlen(newChar) - strlen(keyphrase) > 0) {

			buffer = new char(arraySize - pos);

			for(int l = pos; l < arraySize; l++)
				buffer[l - pos] = output[l];
			cout << "check 9" << endl;
			grow1DArray(output, arraySize, arraySize + (strlen(newChar) - strlen(keyphrase)));
		} else {

			buffer = new char(arraySize - pos);

			for(int l = pos; l < arraySize; l++)
				buffer[l - pos] = output[l];

			shrink1DArray(output, arraySize, arraySize - (strlen(newChar) - strlen(keyphrase)));
		}
			arraySize += (strlen(newChar) - strlen(keyphrase));
			cout << "check 10" << endl;
			for(int m = pos; m < pos + strlen(newChar); m++)
				output[m] = newChar[m];

			output[pos + strlen(newChar) + 1] = ' ';

			for(int n = pos + strlen(newChar) + 2; n < arraySize; n++)
				output[n] = buffer[n - (pos + strlen(newChar) + 2)];

			int progress = 0;
			int line = 0;

			while(progress != arraySize) {
				for(int p = 0; p < 29; p++) {
					array[line][p + progress] = output[p + progress];
					if(output[p + progress] == '\n'){
						progress += p;
						break;
					}

				}
				cout << "check 11" << endl;
			if(line == para_size)
				growArray(para_size + 1);

			line++;
			}
			cout << "check 12" << endl;
			cout << output << endl;

	}
}
